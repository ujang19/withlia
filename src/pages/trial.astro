---
import BaseLayout from "../layouts/BaseLayout.astro";
import NavBar from "../components/NavBar.tsx";
import Footer from "../components/Footer.astro";
import { site } from "../lib/seo";

// Safely obtain the current request URL and parse query params.
// Astro.request.url can be absolute (https://...) or relative (/trial?...).
// Use `site` as base when needed so query params are preserved.
let requestUrlRaw = '';
if (typeof Astro !== 'undefined' && (Astro as any).request && (Astro as any).request.url) {
  requestUrlRaw = (Astro as any).request.url;
}

// Default to absolute trial URL if we still don't have one
if (!requestUrlRaw) requestUrlRaw = `${site}/trial`;

let urlObj: URL;
try {
  // If requestUrlRaw is relative (starts with '/'), provide base so URL parsing keeps querystring
  if (/^\//.test(requestUrlRaw)) {
    urlObj = new URL(requestUrlRaw, site);
  } else {
    urlObj = new URL(requestUrlRaw);
  }
} catch (e) {
  urlObj = new URL(`${site}/trial`);
}

let name = urlObj.searchParams.get("name") || "";
name = name.replace(/\+/g, " ").trim();
if (name.startsWith("@")) name = name.slice(1).trim();
// Fallback: show no name so headline reads "Kak" only
const displayName = name || "";
const nameSuffix = displayName ? ` ${displayName}` : "";
---

<BaseLayout title={`Withlia Trial ‚Äî ${displayName || "Day 1"}`} url={`${site}/trial`}>
  <NavBar client:idle />

  <main class="min-h-screen flex items-center py-16 md:py-24">
    <div class="container-w max-w-2xl text-center">
      <span class="inline-flex items-center rounded-full border border-black/10 bg-white/70 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-black/60">Trial Day 1</span>
      <h1 class="mt-3 text-4xl md:text-5xl font-extrabold leading-tight tracking-tight">
        <span class="text-[var(--blue)]">Selamat, Kak</span><span id="trial-name">{nameSuffix}</span>.
      </h1>
      <p class="mt-3 text-base text-black/70">Kamu mendapatkan akses <strong>WithLia Day 1 ‚Äì Trial Version</strong>.</p>

      <!-- Akses Hari Ini -->
      <section class="mt-10">
        <h2 class="text-sm font-semibold text-black/60">Akses Hari Ini</h2>
        <div class="mt-4 flex flex-col items-center gap-3 sm:flex-row sm:justify-center">
          <a href="https://drive.google.com/file/d/1g4BNQXCfsnSSmfJ-2TNXP0BwZoUb5eIS/view?usp=sharing" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center gap-2 rounded-xl bg-[var(--blue)] px-6 py-3 font-semibold text-white hover:opacity-95">Download PDF Day 1</a>
          <a href="https://chatgpt.com/g/g-685fa16a2570819186216fac4842a0ea-lily-sahabat-marketer" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center gap-2 rounded-xl border-2 border-[var(--blue)] px-6 py-3 font-semibold text-[var(--blue)] hover:bg-[var(--blue)] hover:text-white">Buka GPTs AI Trial</a>
        </div>
      </section>

      <!-- Day 1 Learnings -->
      <section class="mx-auto mt-10 max-w-xl text-left">
        <h2 class="text-lg font-extrabold text-center">Apa yang Kamu Pelajari di Day 1</h2>
        <p class="mt-2 text-black/80 text-center"><strong>Menentukan Niche & Audiens Ideal</strong></p>
        <ul class="mt-4 space-y-3 text-black/80">
          <li class="flex items-start gap-3">
            <svg class="mt-1 h-5 w-5 text-[var(--orange)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M20 6L9 17l-5-5"/></svg>
            <span>Temukan titik temu antara <strong>minat</strong>, <strong>skill</strong>, dan <strong>peluang pasar</strong></span>
          </li>
          <li class="flex items-start gap-3">
            <svg class="mt-1 h-5 w-5 text-[var(--orange)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M20 6L9 17l-5-5"/></svg>
            <span>Pahami siapa audiens yang paling tepat untuk kamu layani</span>
          </li>
          <li class="flex items-start gap-3">
            <svg class="mt-1 h-5 w-5 text-[var(--orange)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M20 6L9 17l-5-5"/></svg>
            <span>Validasi niche sebelum terjun, supaya tidak buang waktu dan tenaga</span>
          </li>
        </ul>
      </section>

      <!-- Upgrade CTA -->
      <section class="mx-auto mt-10 max-w-xl">
        <h2 class="text-lg font-extrabold text-center">Biar Kamu Makin Maksimal</h2>
        <p class="mt-2 text-black/70 text-center">Day 1 baru pembuka. Kalau mau akses penuh materi, AI versi lengkap, dan komunitas:</p>
        <ul class="mt-4 space-y-3 text-black/80 text-left">
          <li class="flex items-start gap-3">
            <svg class="mt-1 h-5 w-5 text-[var(--orange)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M20 6L9 17l-5-5"/></svg>
            <span>Akses semua hari dan materi premium</span>
          </li>
          <li class="flex items-start gap-3">
            <svg class="mt-1 h-5 w-5 text-[var(--orange)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M20 6L9 17l-5-5"/></svg>
            <span>GPTs AI versi full untuk marketing</span>
          </li>
          <li class="flex items-start gap-3">
            <svg class="mt-1 h-5 w-5 text-[var(--orange)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M20 6L9 17l-5-5"/></svg>
            <span>Framework lengkap + komunitas support</span>
          </li>
        </ul>
        <div class="mt-6 flex justify-center">
          <a href="https://app.withlia.id/checkout/?add-to-cart=1163&quantity=1" target="_blank" rel="noopener" class="inline-flex items-center justify-center rounded-xl bg-[var(--orange)] px-6 py-3 font-semibold text-white hover:opacity-95">Dapatkan Versi Lengkap</a>
        </div>
        <p class="mt-4 text-sm text-black/60">üå± <em>Minimal satu langkah ini udah bikin kamu selangkah lebih dekat ke arah yang jelas.</em><br/><strong>Maaf deh‚Ä¶</strong> kalau udah nyobain, biasanya susah balik ke cara lama. üòè</p>
      </section>
    </div>
  </main>

  <script>
    // Client-side enhancement: read `name` from query string and replace the placeholder.
    (function () {
      try {
        const params = new URLSearchParams(window.location.search || '');
        let n = params.get('name') || '';
        n = decodeURIComponent(n.replace(/\+/g, ' ')).trim();
        if (n.startsWith('@')) n = n.slice(1).trim();
        if (n) {
          const el = document.getElementById('trial-name');
          if (el) el.textContent = ` ${n}`; // prepend space for natural reading after "Kak"
          // update title to match
          document.title = `Withlia Trial ‚Äî ${n}`;
        }
      } catch (e) {
        // no-op on errors
      }
    })();
  </script>

  <!-- Confetti on first load (lightweight, respects reduced motion) -->
  <script>
    (function () {
      try {
        const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (reduce) return;

        function fireConfetti() {
          if (!window.confetti) return;
          const count = 140;
          const defaults = { origin: { y: 0.2 } };
          function fire(particleRatio, opts) {
            window.confetti(Object.assign({}, defaults, opts, { particleCount: Math.floor(count * particleRatio) }));
          }
          fire(0.25, { spread: 26, startVelocity: 45 });
          fire(0.2, { spread: 60 });
          fire(0.35, { spread: 100, decay: 0.92, scalar: 0.9 });
          fire(0.1, { spread: 120, startVelocity: 35 });
          fire(0.1, { spread: 120, startVelocity: 25, origin: { y: 0.6 } });
        }

        if (window.confetti) {
          fireConfetti();
        } else {
          const s = document.createElement('script');
          s.src = 'https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js';
          s.async = true;
          s.onload = fireConfetti;
          document.head.appendChild(s);
        }
      } catch (_) { /* noop */ }
    })();
  </script>

  <Footer />
</BaseLayout>
