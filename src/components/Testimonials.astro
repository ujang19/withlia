---
/**
 * Testimonials section in a "bento" card grid style (4 cards).
 * Matches site styling: container-w, rounded-2xl, subtle borders, white cards.
 */
const { id, class: _class, className = "", title = "Testimoni Pengguna WithLia", ...rest } = Astro.props;
---
<section {...rest} id={id} class={`w-full py-20 ${_class ? _class : ""} ${className}`} data-testimonials>
  <div class="container-w">
    <h2 class="text-center font-extrabold leading-tight tracking-tight text-3xl md:text-3xl">
      {title}
    </h2>

    <!-- Mobile / small: stacked grid (fallback) -->
    <div class="mt-8 grid grid-cols-1 gap-4 md:hidden">
      <article class="rounded-2xl border border-black/10 bg-white p-6 shadow-card">
        <header class="flex items-center gap-3">
          <img src="/dummy.jpg" alt="Foto Adit" class="h-10 w-10 rounded-full object-cover" loading="lazy" decoding="async" />
          <div>
            <div class="font-semibold">Adit</div>
            <div class="text-xs text-black/60">Owner UMKM F&B</div>
          </div>
        </header>
        <p class="mt-4 text-[15px] leading-relaxed text-black/80">“Konten jadi 3× lebih cepat, dan engagement naik 45% di minggu ke-2. Framework-nya jelas, tinggal eksekusi.”</p>
      </article>

      <article class="rounded-2xl border border-black/10 bg-white p-6 shadow-card">
        <header class="flex items-center gap-3">
          <img src="/dummy.jpg" alt="Foto Robby - Software Development" class="h-10 w-10 rounded-full object-cover" loading="lazy" decoding="async" />
          <div>
            <div class="font-semibold">Robby, Software Development</div>
            <div class="text-xs text-black/60">Bank Raya Indonesia</div>
          </div>
        </header>
        <p class="mt-4 text-[15px] leading-relaxed text-black/80">“Materi dan framework WithLia sudah kami gunakan dalam presentasi Eksplorasi digital marketing di Bank Raya Indonesia. Sangat insightful dan mudah di implemantasikan sesuai dengan kebutuhan industri digital. Ini bukti bahwa materi dan AI assistant yang digunakan oleh WithLia sesuai dengan kebutuhan perusahaan.”</p>
      </article>

      <article class="rounded-2xl border border-black/10 bg-white p-6 shadow-card">
        <header class="flex items-center gap-3">
          <img src="/dummy.jpg" alt="Foto Bima" class="h-10 w-10 rounded-full object-cover" loading="lazy" decoding="async" />
          <div>
            <div class="font-semibold">Bima</div>
            <div class="text-xs text-black/60">Owner Brand Fashion</div>
          </div>
        </header>
        <p class="mt-4 text-[15px] leading-relaxed text-black/80">“AI-nya paham tone brand. Caption dan idee konten nggak terasa generik, lebih nyambung ke audiensku.”</p>
      </article>

      <article class="rounded-2xl border border-black/10 bg-white p-6 shadow-card">
        <header class="flex items-center gap-3">
          <img src="/dummy.jpg" alt="Foto Dian" class="h-10 w-10 rounded-full object-cover" loading="lazy" decoding="async" />
          <div>
            <div class="font-semibold">Dian</div>
            <div class="text-xs text-black/60">Edupreneur</div>
          </div>
        </header>
        <p class="mt-4 text-[15px] leading-relaxed text-black/80">“Mentornya responsif dan praktis. Roadmap 7 hari bikin aku beneran jalan — bukan cuma belajar.”</p>
      </article>
    </div>

    <!-- Desktop: centered slider with blurred neighbors -->
    <div class="mt-8 hidden md:block">
      <div class="relative">
        <!-- Prev/Next buttons -->
        <button aria-label="Prev" class="testimonials-prev absolute left-0 top-1/2 -translate-y-1/2 z-10 inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/90 shadow-md hover:opacity-95">‹</button>
        <button aria-label="Next" class="testimonials-next absolute right-0 top-1/2 -translate-y-1/2 z-10 inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/90 shadow-md hover:opacity-95">›</button>

        <div class="testimonials-slides">
          <div class="slides flex items-stretch gap-6 px-16">
            <article class="slide active flex-none w-[640px] rounded-2xl border border-black/10 bg-white p-8 shadow-card">
              <header class="flex items-center gap-3">
                <img src="/dummy.jpg" alt="Foto Adit" class="h-12 w-12 rounded-full object-cover" loading="lazy" decoding="async" />
                <div>
                  <div class="font-semibold">Adit</div>
                  <div class="text-xs text-black/60">Owner UMKM F&B</div>
                </div>
              </header>
              <p class="mt-4 text-[15px] leading-relaxed text-black/80">“Konten jadi 3× lebih cepat, dan engagement naik 45% di minggu ke-2. Framework-nya jelas, tinggal eksekusi.”</p>
            </article>

            <article class="slide flex-none w-[720px] rounded-2xl border border-black/10 bg-white p-8 shadow-card">
              <header class="flex items-center gap-3">
                <img src="/dummy.jpg" alt="Foto Robby - Software Development" class="h-12 w-12 rounded-full object-cover" loading="lazy" decoding="async" />
                <div>
                  <div class="font-semibold">Robby, Software Development</div>
                  <div class="text-xs text-black/60">Bank Raya Indonesia</div>
                </div>
              </header>
              <p class="mt-4 text-[15px] leading-relaxed text-black/80">“Materi dan framework WithLia sudah kami gunakan dalam presentasi Eksplorasi digital marketing di Bank Raya Indonesia. Sangat insightful dan mudah di implemantasikan sesuai dengan kebutuhan industri digital. Ini bukti bahwa materi dan AI assistant yang digunakan oleh WithLia sesuai dengan kebutuhan perusahaan.”</p>
            </article>

            <article class="slide flex-none w-[640px] rounded-2xl border border-black/10 bg-white p-8 shadow-card">
              <header class="flex items-center gap-3">
                <img src="/dummy.jpg" alt="Foto Bima" class="h-12 w-12 rounded-full object-cover" loading="lazy" decoding="async" />
                <div>
                  <div class="font-semibold">Bima</div>
                  <div class="text-xs text-black/60">Owner Brand Fashion</div>
                </div>
              </header>
              <p class="mt-4 text-[15px] leading-relaxed text-black/80">“AI-nya paham tone brand. Caption dan ide konten nggak terasa generik, lebih nyambung ke audiensku.”</p>
            </article>

            <article class="slide flex-none w-[640px] rounded-2xl border border-black/10 bg-white p-8 shadow-card">
              <header class="flex items-center gap-3">
                <img src="/dummy.jpg" alt="Foto Dian" class="h-12 w-12 rounded-full object-cover" loading="lazy" decoding="async" />
                <div>
                  <div class="font-semibold">Dian</div>
                  <div class="text-xs text-black/60">Edupreneur</div>
                </div>
              </header>
              <p class="mt-4 text-[15px] leading-relaxed text-black/80">“Mentornya responsif dan praktis. Roadmap 7 hari bikin aku beneran jalan — bukan cuma belajar.”</p>
            </article>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* Desktop slider styles */
  .testimonials-slides { overflow: hidden; position: relative; }
  .slides { display: flex; align-items: stretch; scroll-behavior: smooth; transition: transform .36s ease; will-change: transform; }
  .slide { scroll-snap-align: center; transition: transform .36s ease, filter .36s ease, opacity .36s ease; }
  .slide.active { filter: none; opacity: 1; transform: none; }
  .slide:not(.active) { filter: blur(4px) brightness(.95); opacity: .65; transform: scale(.98); }
    .slides { scroll-snap-type: x mandatory; padding-left: 0; padding-right: 0; }
    /* ensure visible halves around center */
    .testimonials-slides { padding: 0 6rem; }
    @media (min-width: 768px) {
      .testimonials-prev, .testimonials-next { display: inline-flex; }
    }
    .testimonials-prev, .testimonials-next { cursor: pointer; }
    .testimonials-prev { left: 0.5rem; }
    .testimonials-next { right: 0.5rem; }
  </style>

  <script>
    (function () {
      function initTestimonials() {
        const root = document.querySelector('[data-testimonials]');
        if (!root) return;
        const container = root.querySelector('.testimonials-slides');
        if (!container) return;
        const slidesWrap = container.querySelector('.slides');
        if (!slidesWrap) return;
        const slides = Array.from(slidesWrap.querySelectorAll('.slide'));
        if (!slides.length) return;

        let idx = 0;
        slidesWrap.style.transition = 'transform .42s cubic-bezier(.22,.9,.24,1)';
        slidesWrap.style.willChange = 'transform';

        const setActive = (i) => {
          idx = (i + slides.length) % slides.length;
          slides.forEach((sl, j) => sl.classList.toggle('active', j === idx));
        };

        const centerActive = () => {
          const active = slides[idx];
          if (!active) return;
          const containerRect = container.getBoundingClientRect();
          const activeRect = active.getBoundingClientRect();
          const containerCenter = containerRect.left + containerRect.width / 2;
          const activeCenter = activeRect.left + activeRect.width / 2;
          const translate = containerCenter - activeCenter;
          slidesWrap.style.transform = `translateX(${translate}px)`;
        };

        const update = (i) => {
          setActive(i);
          // allow layout to settle for images/fonts
          requestAnimationFrame(() => requestAnimationFrame(centerActive));
        };

        // initialize immediately
        setActive(0);
        // center after a short delay once layout settled
        setTimeout(centerActive, 30);

        // Prev / Next
        root.querySelector('.testimonials-prev')?.addEventListener('click', (e) => { e.preventDefault(); update(idx - 1); });
        root.querySelector('.testimonials-next')?.addEventListener('click', (e) => { e.preventDefault(); update(idx + 1); });

        // keyboard navigation
        window.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowLeft') update(idx - 1);
          if (e.key === 'ArrowRight') update(idx + 1);
        });

        // autoplay (infinite loop) with pause on hover/focus
        let autoplay = true;
        let autoplayInterval = 5000; // ms
        let autoplayTimer = null;
        const startAutoplay = () => {
          if (!autoplay) return;
          stopAutoplay();
          autoplayTimer = setInterval(() => update(idx + 1), autoplayInterval);
        };
        const stopAutoplay = () => {
          if (autoplayTimer) { clearInterval(autoplayTimer); autoplayTimer = null; }
        };

        // pause on hover/focus
        root.addEventListener('mouseenter', () => stopAutoplay());
        root.addEventListener('mouseleave', () => startAutoplay());
        window.addEventListener('blur', () => stopAutoplay());
        window.addEventListener('focus', () => startAutoplay());

        // start autoplay after initial center
        setTimeout(() => startAutoplay(), 800);

        // pointer/touch drag support for swipe
        let pointerDown = false, startX = 0, currentTranslate = 0;
        slidesWrap.addEventListener('pointerdown', (ev) => {
          pointerDown = true;
          startX = ev.clientX;
          slidesWrap.style.transition = 'none';
          // compute current translate from matrix
          const style = window.getComputedStyle(slidesWrap);
          const matrix = new WebKitCSSMatrix(style.transform || '');
          currentTranslate = matrix.m41 || 0;
          slidesWrap.setPointerCapture(ev.pointerId);
          // pause autoplay while dragging
          stopAutoplay();
        });
        slidesWrap.addEventListener('pointermove', (ev) => {
          if (!pointerDown) return;
          const dx = ev.clientX - startX;
          slidesWrap.style.transform = `translateX(${currentTranslate + dx}px)`;
        });
        slidesWrap.addEventListener('pointerup', (ev) => {
          if (!pointerDown) return;
          pointerDown = false;
          slidesWrap.style.transition = 'transform .42s cubic-bezier(.22,.9,.24,1)';
          const dx = ev.clientX - startX;
          // threshold
          if (dx > 60) update(idx - 1);
          else if (dx < -60) update(idx + 1);
          else centerActive();
          // resume autoplay shortly after
          setTimeout(() => startAutoplay(), 800);
        });
        slidesWrap.addEventListener('pointercancel', () => { pointerDown = false; centerActive(); });

        // re-center on resize
        let rt;
        window.addEventListener('resize', () => {
          clearTimeout(rt);
          rt = setTimeout(() => centerActive(), 120);
        });
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTestimonials);
      } else {
        initTestimonials();
      }
    })();
  </script>
</section>
